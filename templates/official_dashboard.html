{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-md-8">
    <div class="card shadow mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="fa-solid fa-calendar-check me-2 text-success"></i> Your Bookings</h5>
        <a class="btn btn-sm btn-primary" href="{{ url_for('book') }}"><i class="fa-solid fa-plus"></i> New booking</a>
      </div>
      <div class="card-body">
        {% if bookings %}
        <table class="table table-striped">
          <thead>
            <tr><th>Date</th><th>Time</th><th>Room</th><th>Status</th><th>Action</th></tr>
          </thead>
          <tbody>
            {% for b in bookings %}
            <tr>
              <td>{{ b.date }}</td>
              <td>{{ b.start_time.strftime('%H:%M') }} - {{ b.end_time.strftime('%H:%M') }}</td>
              <td>{{ b.room.room_name }}</td>
              <td>
                {% if b.status == 'pending' %}
                  <span class="badge bg-warning text-dark">Pending</span>
                {% elif b.status == 'approved' %}
                  <span class="badge bg-success">Approved</span>
                {% else %}
                  <span class="badge bg-danger">Declined</span>
                {% endif %}
              </td>
              <td>
                {% if current_user.role == 'admin' %}
                  <!-- Approve button -->
                  <form action="{{ url_for('approve_booking', booking_id=b.id) }}" method="POST" style="display:inline;">
                    <button class="btn btn-success btn-sm" type="submit">Approve</button>
                  </form>

                  <!-- Reject button -->
                  <form action="{{ url_for('reject_booking', booking_id=b.id) }}" method="POST" style="display:inline;">
                    <button class="btn btn-danger btn-sm" type="submit">Reject</button>
                  </form>
                {% else %}
                  {% if b.status == 'declined' and b.reason %}
                    <i class="fa-solid fa-info-circle" title="Reason: {{ b.reason }}"></i>
                  {% endif %}
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <p class="text-muted">You have no bookings yet. Create a new booking to get started.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h6 class="card-title"><i class="fa-solid fa-user me-2"></i> Account</h6>
        <p class="mb-1"><strong>{{ current_user.name }}</strong></p>
        <p class="text-muted mb-2">{{ current_user.email }}</p>
        <a href="{{ url_for('book') }}" class="btn btn-outline-primary btn-sm w-100"><i class="fa-solid fa-calendar-plus me-1"></i> Make a booking</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
